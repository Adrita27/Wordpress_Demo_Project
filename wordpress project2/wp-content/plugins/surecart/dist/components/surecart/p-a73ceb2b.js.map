{"version":3,"names":["submitCartForm","async","_a","state","selectedPrice","id","_b","ad_hoc","adHocAmount","undefined","savedCheckout","getCheckout","formId","mode","busy","checkout","addLineItem","data","price","_c","quantity","Math","max","_d","variant","_e","selectedVariant","_f","ad_hoc_amount","live_mode","setCheckout","toggleCart","dialog","e","console","error","getProductBuyLink","url","query","addQueryArgs","line_items","_g"],"sources":["./src/store/product/mutations.ts"],"sourcesContent":["import { addLineItem } from '../../services/session';\nimport state from './store';\nimport { getCheckout, setCheckout } from '@store/checkouts/mutations';\nimport { Checkout } from 'src/types';\nimport { toggleCart } from '@store/ui';\nimport { addQueryArgs } from '@wordpress/url';\n\nexport const submitCartForm = async () => {\n  if (!state.selectedPrice?.id) return;\n  if (state.selectedPrice?.ad_hoc && (null === state.adHocAmount || undefined === state.adHocAmount)) return;\n  const savedCheckout = getCheckout(state?.formId, state.mode);\n  try {\n    state.busy = true;\n    const checkout = await addLineItem({\n      checkout: savedCheckout,\n      data: {\n        price: state.selectedPrice?.id,\n        quantity: Math.max(state.selectedPrice?.ad_hoc ? 1 : state.quantity, 1),\n        variant: state.selectedVariant?.id,\n        ...(state.selectedPrice?.ad_hoc ? { ad_hoc_amount: state.adHocAmount } : {}),\n      },\n      live_mode: state.mode !== 'test',\n    });\n    setCheckout(checkout as Checkout, state.formId);\n    toggleCart(true);\n    state.dialog = null;\n  } catch (e) {\n    console.error(e);\n    state.error = e;\n  } finally {\n    state.busy = false;\n  }\n};\n\nexport const getProductBuyLink = (url, query = {}) => {\n  if (!state.selectedPrice?.id) return;\n  if (state.selectedPrice?.ad_hoc && !state.adHocAmount) return;\n\n  return addQueryArgs(url, {\n    line_items: [\n      {\n        price: state.selectedPrice?.id,\n        quantity: state.selectedPrice?.ad_hoc ? 1 : state.quantity,\n        ...(state.selectedPrice?.ad_hoc ? { ad_hoc_amount: state.adHocAmount } : {}),\n        ...(state.selectedVariant?.id ? { variant: state.selectedVariant?.id } : {}),\n      },\n    ],\n    ...query,\n  });\n};\n"],"mappings":"iMAOaA,EAAiBC,U,gBAC5B,MAAKC,EAAAC,EAAMC,iBAAa,MAAAF,SAAA,SAAAA,EAAEG,IAAI,OAC9B,KAAIC,EAAAH,EAAMC,iBAAa,MAAAE,SAAA,SAAAA,EAAEC,UAAW,OAASJ,EAAMK,aAAeC,YAAcN,EAAMK,aAAc,OACpG,MAAME,EAAgBC,EAAYR,IAAK,MAALA,SAAK,SAALA,EAAOS,OAAQT,EAAMU,MACvD,IACEV,EAAMW,KAAO,KACb,MAAMC,QAAiBC,EAAY,CACjCD,SAAUL,EACVO,KAAM,CACJC,OAAOC,EAAAhB,EAAMC,iBAAa,MAAAe,SAAA,SAAAA,EAAEd,GAC5Be,SAAUC,KAAKC,MAAIC,EAAApB,EAAMC,iBAAa,MAAAmB,SAAA,SAAAA,EAAEhB,QAAS,EAAIJ,EAAMiB,SAAU,GACrEI,SAASC,EAAAtB,EAAMuB,mBAAe,MAAAD,SAAA,SAAAA,EAAEpB,QAC5BsB,EAAAxB,EAAMC,iBAAa,MAAAuB,SAAA,SAAAA,EAAEpB,QAAS,CAAEqB,cAAezB,EAAMK,aAAgB,IAE3EqB,UAAW1B,EAAMU,OAAS,SAE5BiB,EAAYf,EAAsBZ,EAAMS,QACxCmB,EAAW,MACX5B,EAAM6B,OAAS,I,CACf,MAAOC,GACPC,QAAQC,MAAMF,GACd9B,EAAMgC,MAAQF,C,SAEd9B,EAAMW,KAAO,K,SAIJsB,EAAoB,CAACC,EAAKC,EAAQ,M,kBAC7C,MAAKpC,EAAAC,EAAMC,iBAAa,MAAAF,SAAA,SAAAA,EAAEG,IAAI,OAC9B,KAAIC,EAAAH,EAAMC,iBAAa,MAAAE,SAAA,SAAAA,EAAEC,UAAWJ,EAAMK,YAAa,OAEvD,OAAO+B,EAAaF,EAAK,CACvBG,WAAY,CACV,CACEtB,OAAOC,EAAAhB,EAAMC,iBAAa,MAAAe,SAAA,SAAAA,EAAEd,GAC5Be,WAAUG,EAAApB,EAAMC,iBAAa,MAAAmB,SAAA,SAAAA,EAAEhB,QAAS,EAAIJ,EAAMiB,cAC9CK,EAAAtB,EAAMC,iBAAa,MAAAqB,SAAA,SAAAA,EAAElB,QAAS,CAAEqB,cAAezB,EAAMK,aAAgB,QACrEmB,EAAAxB,EAAMuB,mBAAe,MAAAC,SAAA,SAAAA,EAAEtB,IAAK,CAAEmB,SAASiB,EAAAtC,EAAMuB,mBAAe,MAAAe,SAAA,SAAAA,EAAEpC,IAAO,QAG1EiC,GACH,S"}