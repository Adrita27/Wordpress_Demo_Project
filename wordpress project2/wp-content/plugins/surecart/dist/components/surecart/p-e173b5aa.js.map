{"version":3,"names":["checkout","getSerializedState","state","onChange","on","set","get","dispose","createStore","formId","groupId","mode","locks","product","currencyCode","abandonedCheckoutEnabled","initialLineItems","isCheckoutPage","validateStock","newValue","oldValue","JSON","stringify","safeRead","storage","key","parse","getItem","debounce","fn","called","setTimeout","createStorageStore","defaultValues","syncAcrossTabs","store","_a","write","setItem","window","addEventListener","currentState","use","reset","createLocalStore","localStorage","removeQueryArgs","url","queryStringIndex","indexOf","query","getQueryArgs","baseURL","substr","_len","arguments","length","args","Array","_key","forEach","arg","queryString","buildQueryString","notPersistCart","scData","do_not_persist_cart","getQueryArg","location","href","live","test","scStore","getCheckout","setCheckout","data","live_mode","checkoutState","id","history","replaceState","document","title","addQueryArgs","checkout_id","clearCheckout","remove","checkouts","val","prop","_","value","Object","keys","handleCheckoutLineItemChange","oldCheckout","newLineItems","line_items","oldLineItems","_b","newItem","oldItem","find","item","quantity","event","CustomEvent","detail","bubbles","dispatchEvent","transaction_id","maybeConvertAmount","total_amount","currency","toUpperCase","discount","promotion","code","coupon","_d","_c","tax_amount","tax","items","_e","map","item_name","price","name","discount_amount","amount","status","includes","deprecated","trialLineItems","filter","trial_duration_days","e","dataLayer","gtag","item_id","item_variant","variant_options","join","_f","_g","_h","_j","push","ecommerce"],"sources":["./src/store/checkout/store.ts","./src/store/local/storage.ts","../../node_modules/@wordpress/url/build-module/remove-query-args.js","./src/store/checkouts/store.ts","./src/store/checkouts/mutations.ts","./src/store/checkout/watchers.ts","./src/store/checkouts/events.ts","./src/store/checkout/events.ts","./src/store/checkout/google.ts"],"sourcesContent":["import { createStore } from '@stencil/store';\n\nimport { Checkout, LineItemData, Product, TaxProtocol } from '../../types';\nimport { getSerializedState } from '@store/utils';\nconst { checkout } = getSerializedState();\n\ninterface Store {\n  formId: number | string;\n  groupId: string;\n  mode: 'live' | 'test';\n  locks: string[];\n  product: Product;\n  checkout: Checkout;\n  currencyCode: string;\n  abandonedCheckoutEnabled: boolean;\n  initialLineItems: LineItemData[];\n  taxProtocol: TaxProtocol;\n  isCheckoutPage: boolean;\n  validateStock: boolean;\n}\n\nconst { state, onChange, on, set, get, dispose } = createStore<Store>(\n  {\n    formId: null,\n    groupId: null,\n    mode: 'live',\n    locks: [],\n    product: null,\n    checkout: null,\n    currencyCode: 'usd',\n    abandonedCheckoutEnabled: true,\n    initialLineItems: [],\n    isCheckoutPage: false,\n    validateStock: false,\n    ...checkout,\n  },\n  (newValue, oldValue) => {\n    return JSON.stringify(newValue) !== JSON.stringify(oldValue);\n  },\n);\n\nexport default state;\nexport { state, onChange, on, set, get, dispose };\n","import { createStore } from '@stencil/store';\nimport { MinimumStorage } from './types';\n\nconst safeRead = <T extends object>(storage: MinimumStorage, key: string): T | null => {\n  try {\n    return JSON.parse(storage.getItem(key));\n  } catch {\n    return null;\n  }\n};\n\nconst debounce = fn => {\n  let called = false;\n  return () => {\n    if (called) {\n      return;\n    }\n    called = true;\n    setTimeout(() => {\n      fn();\n      called = false;\n    }, 0);\n  };\n};\n\nexport const createStorageStore = <T extends object>(storage: MinimumStorage, key: string, defaultValues: T, syncAcrossTabs = false) => {\n  const store = createStore(safeRead<T>(storage, key) ?? defaultValues, (newValue, oldValue) => {\n    return JSON.stringify(newValue) !== JSON.stringify(oldValue);\n  });\n\n  // Need to sync later or we would get ourselves in an infinite loop.\n  const write = debounce(() => storage.setItem(key, JSON.stringify(store.state)));\n  write();\n\n  if (syncAcrossTabs) {\n    window.addEventListener('storage', () => {\n      const currentState = safeRead<T>(storage, key);\n\n      if (currentState === null) {\n        return;\n      }\n\n      for (const key in currentState) {\n        store.set(key, currentState[key]);\n      }\n    });\n  }\n\n  store.use({ set: write, reset: write });\n\n  return store;\n};\n\nexport const createLocalStore = <T extends object>(key: string, defaultValues: T, syncAcrossTabs = false) => createStorageStore(localStorage, key, defaultValues, syncAcrossTabs);\nexport const createSessionStore = <T extends object>(key: string, defaultValues: T) => createStorageStore(sessionStorage, key, defaultValues);\n","/**\n * Internal dependencies\n */\nimport { getQueryArgs } from './get-query-args';\nimport { buildQueryString } from './build-query-string';\n/**\n * Removes arguments from the query string of the url\n *\n * @param {string}    url  URL.\n * @param {...string} args Query Args.\n *\n * @example\n * ```js\n * const newUrl = removeQueryArgs( 'https://wordpress.org?foo=bar&bar=baz&baz=foobar', 'foo', 'bar' ); // https://wordpress.org?baz=foobar\n * ```\n *\n * @return {string} Updated URL.\n */\n\nexport function removeQueryArgs(url) {\n  const queryStringIndex = url.indexOf('?');\n\n  if (queryStringIndex === -1) {\n    return url;\n  }\n\n  const query = getQueryArgs(url);\n  const baseURL = url.substr(0, queryStringIndex);\n\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  args.forEach(arg => delete query[arg]);\n  const queryString = buildQueryString(query);\n  return queryString ? baseURL + '?' + queryString : baseURL;\n}\n//# sourceMappingURL=remove-query-args.js.map","import { createLocalStore } from '../local';\nimport { createStore } from '@stencil/store';\nimport { getQueryArg } from '@wordpress/url';\n\nconst notPersistCart = !!window?.scData?.do_not_persist_cart || !!getQueryArg(window.location.href, 'no_cart');\n\nconst store = notPersistCart\n  ? createStore<{ live: any; test: any }>({\n      live: {},\n      test: {},\n    })\n  : createLocalStore<{ live: any; test: any }>(\n      'surecart-local-storage',\n      {\n        live: {},\n        test: {},\n      },\n      true,\n    );\n\nconst { state, onChange, on, set, get, dispose } = store;\nwindow.scStore = store;\nexport default store;\nexport { state, onChange, on, set, get, dispose };\n","import { Checkout } from 'src/types';\nimport store from './store';\nimport { state as checkoutState } from '@store/checkout';\nimport { addQueryArgs, removeQueryArgs } from '@wordpress/url';\n\n/** Get the checkout. */\nexport const getCheckout = (formId: number | string, mode: 'live' | 'test') => store.state[mode]?.[formId] || {};\n\n/** Set the checkout. */\nexport const setCheckout = (data: Checkout, formId: number | string) => {\n  const mode = data?.live_mode ? 'live' : 'test';\n  store.set(mode, { ...store.state[mode], [formId]: data });\n  // update the current checkout state.\n  if (checkoutState.formId === formId && checkoutState.mode === mode) {\n    checkoutState.checkout = data;\n  }\n  // set in url only if we are not persisting the cart.\n  if (window?.scData?.do_not_persist_cart && data?.id) {\n    window.history.replaceState({}, document.title, addQueryArgs(window.location.href, { checkout_id: data?.id }));\n  }\n};\n\n/** Clear the order from the store. */\nexport const clearCheckout = (formId: number | string, mode: 'live' | 'test') => {\n  const { [formId]: remove, ...checkouts } = store.state[mode];\n  window.history.replaceState({}, document.title, removeQueryArgs(window.location.href, 'redirect_status', 'coupon', 'line_items', 'confirm_checkout_id', 'checkout_id'));\n  return store.set(mode, checkouts);\n};\n","import state, { onChange, on } from './store';\nimport { getCheckout, setCheckout } from '../checkouts/mutations';\n\n/**\n * When the checkout changes, update the\n * checkout in localstorage.\n */\nonChange('checkout', val => setCheckout(val, state.formId));\n\non('get', prop => {\n  if (prop === 'checkout') {\n    const checkout = getCheckout(state.formId, state.mode);\n    if (checkout?.id) {\n      state.checkout = checkout;\n    }\n  }\n});\n","import { on } from './store';\nimport { Checkout, LineItem } from 'src/types';\n// import { maybeConvertAmount } from '../../functions/currency';\n\n// Listen to all stored checkouts and handle line item changes.\non('set', (_, value, oldValue) => Object.keys(value || {}).forEach(key => handleCheckoutLineItemChange(value[key] as Checkout, oldValue?.[key])));\n\n/**\n * Add to cart/remove from cart, cart updated events.\n */\nexport const handleCheckoutLineItemChange = (checkout: Checkout, oldCheckout: Checkout) => {\n  // get new and old line items.\n  const newLineItems = (checkout as Checkout)?.line_items?.data || [];\n  const oldLineItems = (oldCheckout as Checkout)?.line_items?.data || [];\n\n  // check for added items or quantity changed\n  newLineItems.forEach(newItem => {\n    const oldItem = oldLineItems.find(item => item.id === newItem.id);\n    // an item was added, or the quantity changed.\n    if (!oldItem || oldItem?.quantity < newItem?.quantity) {\n      const event = new CustomEvent<LineItem>('scAddedToCart', {\n        detail: {\n          ...newItem,\n          quantity: newItem.quantity - (oldItem?.quantity || 0),\n        },\n        bubbles: true,\n      });\n      document.dispatchEvent(event);\n    }\n  });\n\n  // check for removed items or quantity changed\n  oldLineItems.forEach(oldItem => {\n    const newItem = newLineItems.find(item => item.id === oldItem.id);\n    // an item was removed, or the quantity changed.\n    if (!newItem || oldItem?.quantity > newItem?.quantity) {\n      const event = new CustomEvent<LineItem>('scRemovedFromCart', {\n        detail: {\n          ...oldItem,\n          quantity: oldItem.quantity - (newItem?.quantity || 0),\n        },\n        bubbles: true,\n      });\n      document.dispatchEvent(event);\n    }\n  });\n\n  // check if line items have changed.\n  if (JSON.stringify(newLineItems) !== JSON.stringify(oldLineItems)) {\n    // emit an event here with the checkout state updates.\n    const event = new CustomEvent<[Checkout, Checkout]>('scCartUpdated', {\n      detail: [checkout, oldCheckout],\n      bubbles: true,\n    });\n    document.dispatchEvent(event);\n  }\n};\n","import '../checkouts/events';\nimport state, { on } from './store';\nimport { Checkout, CheckoutInitiatedParams, LineItem, Product } from 'src/types';\nimport { maybeConvertAmount } from '../../functions/currency';\n\n/**\n * Checkout initiated event.\n */\non('set', (key, checkout: Checkout, oldCheckout: Checkout) => {\n  if (key !== 'checkout') return; // we only care about checkout\n  if (oldCheckout?.id) return; // we only care about new checkouts.\n  if (!checkout?.id) return; // we don't have a saved checkout.\n  if (!state.isCheckoutPage) return; // we don't want to fire this if we are not on the checkout page.\n\n  const event = new CustomEvent<CheckoutInitiatedParams>('scCheckoutInitiated', {\n    detail: {\n      transaction_id: checkout.id,\n      value: maybeConvertAmount(checkout?.total_amount, checkout?.currency || 'USD'),\n      currency: (checkout.currency || '').toUpperCase(),\n      ...(checkout?.discount?.promotion?.code ? { coupon: checkout?.discount?.promotion?.code } : {}),\n      ...(checkout?.tax_amount ? { tax: maybeConvertAmount(checkout?.tax_amount, checkout?.currency || 'USD') } : {}),\n      items: (checkout?.line_items?.data || []).map(item => ({\n        item_name: (item?.price?.product as Product)?.name || '',\n        discount: item?.discount_amount ? maybeConvertAmount(item?.discount_amount || 0, checkout?.currency || 'USD') : 0,\n        price: maybeConvertAmount(item?.price?.amount || 0, checkout?.currency || 'USD'),\n        quantity: item?.quantity || 1,\n      })),\n    },\n    bubbles: true,\n  });\n\n  document.dispatchEvent(event);\n});\n\n/**\n * Purchase complete, trial start event.\n */\non('set', (key, checkout: Checkout, oldCheckout: Checkout) => {\n  if (key !== 'checkout') return; // we only care about checkout\n  if (!checkout?.status || oldCheckout?.status === checkout?.status) return; // we only care about status changes.\n  if (!['paid', 'processing'].includes(checkout.status)) return; // only if it's paid or processing.\n\n  // order paid is deprecated.\n  const deprecated = new CustomEvent('scOrderPaid', { detail: checkout, bubbles: true });\n  document.dispatchEvent(deprecated);\n\n  // emit the new event.\n  const event = new CustomEvent('scCheckoutCompleted', { detail: checkout, bubbles: true });\n  document.dispatchEvent(event);\n\n  // get trial line items and emit trial event if there are any.\n  const trialLineItems: LineItem[] = (checkout?.line_items?.data || []).filter(item => item?.price?.trial_duration_days > 0);\n  if (trialLineItems.length > 0) {\n    const event = new CustomEvent('scTrialStarted', { detail: trialLineItems, bubbles: true });\n    document.dispatchEvent(event);\n  }\n});\n","import { maybeConvertAmount } from '../../functions/currency';\nimport { LineItem, Product } from 'src/types';\n\n/**\n * Handle add to cart event.\n */\nwindow.addEventListener('scAddedToCart', function (e: CustomEvent) {\n  if (!window?.dataLayer && !window?.gtag) return;\n\n  // get the added item from the event.\n  const item: LineItem = e.detail;\n\n  // sanity check.\n  if (!item?.price?.product) return;\n\n  // create the items array.\n  const items = [\n    {\n      item_id: (item.price?.product as Product)?.id,\n      item_name: (item.price?.product as Product)?.name,\n      item_variant: (item.variant_options || []).join(' / '),\n      price: maybeConvertAmount(item?.price?.amount || 0, item.price?.currency || 'USD'),\n      currency: item.price?.currency,\n      quantity: item.quantity,\n      discount: item?.discount_amount ? maybeConvertAmount(item?.discount_amount || 0, item.price?.currency || 'USD') : 0,\n    },\n  ];\n\n  // handle google analytics script\n  if (window?.gtag) {\n    window.gtag('event', 'add_to_cart', {\n      items,\n    });\n  }\n\n  // handle datalayer\n  if (window?.dataLayer) {\n    window.dataLayer.push({ ecommerce: null });\n    window.dataLayer.push({\n      event: 'add_to_cart',\n      ecommerce: {\n        data: {\n          items,\n        },\n      },\n    });\n  }\n});\n\n/**\n * Handle purchase complete event.\n */\nwindow.addEventListener('scCheckoutCompleted', function (e: CustomEvent) {\n  if (!window?.dataLayer && !window?.gtag) return;\n\n  const checkout = e.detail;\n\n  const data = {\n    transaction_id: checkout?.id,\n    value: maybeConvertAmount(checkout?.total_amount, checkout?.currency || 'USD'),\n    currency: (checkout.currency || '').toUpperCase(),\n    ...(checkout?.discount?.promotion?.code ? { coupon: checkout?.discount?.promotion?.code } : {}),\n    ...(checkout?.tax_amount ? { tax: maybeConvertAmount(checkout?.tax_amount, checkout?.currency || 'USD') } : {}),\n    items: (checkout?.line_items?.data || []).map(item => ({\n      item_id: (item?.price?.product as Product)?.id,\n      currency: (checkout.currency || '').toUpperCase(),\n      item_name: (item?.price?.product as Product)?.name || '',\n      discount: item?.discount_amount ? maybeConvertAmount(item?.discount_amount || 0, item?.price?.currency || 'USD') : 0,\n      price: maybeConvertAmount(item?.price?.amount || 0, item?.price?.currency || 'USD'),\n      quantity: item?.quantity || 1,\n      item_variant: (item.variant_options || []).join(' / '),\n    })),\n  };\n\n  // handle gtag (analytics script.)\n  if (window?.gtag) {\n    window.gtag('event', 'purchase', data);\n  }\n\n  // handle dataLayer (google tag manager).\n  if (window?.dataLayer) {\n    window.dataLayer.push({ ecommerce: null }); // Clear the previous ecommerce object.\n    window.dataLayer.push({\n      event: 'purchase',\n      ecommerce: data,\n    });\n  }\n});\n"],"mappings":"kMAIA,MAAMA,SAAEA,GAAaC,I,MAiBfC,MAAEA,EAAKC,SAAEA,EAAQC,GAAEA,EAAEC,IAAEA,EAAGC,IAAEA,EAAGC,QAAEA,GAAYC,EACjD,CACEC,OAAQ,KACRC,QAAS,KACTC,KAAM,OACNC,MAAO,GACPC,QAAS,KACTb,SAAU,KACVc,aAAc,MACdC,yBAA0B,KAC1BC,iBAAkB,GAClBC,eAAgB,MAChBC,cAAe,SACZlB,IAEL,CAACmB,EAAUC,IACFC,KAAKC,UAAUH,KAAcE,KAAKC,UAAUF,KClCvD,MAAMG,EAAW,CAAmBC,EAAyBC,KAC3D,IACE,OAAOJ,KAAKK,MAAMF,EAAQG,QAAQF,G,CAClC,MACA,OAAO,I,GAIX,MAAMG,EAAWC,IACf,IAAIC,EAAS,MACb,MAAO,KACL,GAAIA,EAAQ,CACV,M,CAEFA,EAAS,KACTC,YAAW,KACTF,IACAC,EAAS,KAAK,GACb,EAAE,CACN,EAGI,MAAME,EAAqB,CAAmBR,EAAyBC,EAAaQ,EAAkBC,EAAiB,S,MAC5H,MAAMC,EAAQ3B,GAAY4B,EAAAb,EAAYC,EAASC,MAAI,MAAAW,SAAA,EAAAA,EAAIH,GAAe,CAACd,EAAUC,IACxEC,KAAKC,UAAUH,KAAcE,KAAKC,UAAUF,KAIrD,MAAMiB,EAAQT,GAAS,IAAMJ,EAAQc,QAAQb,EAAKJ,KAAKC,UAAUa,EAAMjC,UACvEmC,IAEA,GAAIH,EAAgB,CAClBK,OAAOC,iBAAiB,WAAW,KACjC,MAAMC,EAAelB,EAAYC,EAASC,GAE1C,GAAIgB,IAAiB,KAAM,CACzB,M,CAGF,IAAK,MAAMhB,KAAOgB,EAAc,CAC9BN,EAAM9B,IAAIoB,EAAKgB,EAAahB,G,KAKlCU,EAAMO,IAAI,CAAErC,IAAKgC,EAAOM,MAAON,IAE/B,OAAOF,CAAK,EAGP,MAAMS,EAAmB,CAAmBnB,EAAaQ,EAAkBC,EAAiB,QAAUF,EAAmBa,aAAcpB,EAAKQ,EAAeC,GClC3J,SAASY,EAAgBC,GAC9B,MAAMC,EAAmBD,EAAIE,QAAQ,KAErC,GAAID,KAAsB,EAAG,CAC3B,OAAOD,CACX,CAEE,MAAMG,EAAQC,EAAaJ,GAC3B,MAAMK,EAAUL,EAAIM,OAAO,EAAGL,GAE9B,IAAK,IAAIM,EAAOC,UAAUC,OAAQC,EAAO,IAAIC,MAAMJ,EAAO,EAAIA,EAAO,EAAI,GAAIK,EAAO,EAAGA,EAAOL,EAAMK,IAAQ,CAC1GF,EAAKE,EAAO,GAAKJ,UAAUI,EAC/B,CAEEF,EAAKG,SAAQC,UAAcX,EAAMW,KACjC,MAAMC,EAAcC,EAAiBb,GACrC,OAAOY,EAAcV,EAAU,IAAMU,EAAcV,CACrD,C,MChCA,MAAMY,MAAmB5B,EAAAG,SAAM,MAANA,cAAM,SAANA,OAAQ0B,UAAM,MAAA7B,SAAA,SAAAA,EAAE8B,wBAAyBC,EAAY5B,OAAO6B,SAASC,KAAM,WAEpG,MAAMlC,EAAQ6B,EACVxD,EAAsC,CACpC8D,KAAM,GACNC,KAAM,KAER3B,EACE,yBACA,CACE0B,KAAM,GACNC,KAAM,IAER,M,MAGArE,MAAEA,EAAKC,SAAEA,EAAQC,GAAEA,EAAEC,IAAEA,EAAGC,IAAEA,EAAGC,QAAEA,GAAY4B,EACnDI,OAAOiC,QAAUrC,E,MCfJsC,EAAc,CAAChE,EAAyBE,KAAqB,IAAAyB,EAAK,QAAAA,EAAAD,EAAMjC,MAAMS,MAAK,MAAAyB,SAAA,SAAAA,EAAG3B,KAAW,EAAE,E,MAGnGiE,EAAc,CAACC,EAAgBlE,K,MAC1C,MAAME,GAAOgE,IAAI,MAAJA,SAAI,SAAJA,EAAMC,WAAY,OAAS,OACxCzC,EAAM9B,IAAIM,EAAM,IAAKwB,EAAMjC,MAAMS,GAAOF,CAACA,GAASkE,IAElD,GAAIE,EAAcpE,SAAWA,GAAUoE,EAAclE,OAASA,EAAM,CAClEkE,EAAc7E,SAAW2E,C,CAG3B,KAAIvC,EAAAG,SAAM,MAANA,cAAM,SAANA,OAAQ0B,UAAM,MAAA7B,SAAA,SAAAA,EAAE8B,uBAAuBS,IAAI,MAAJA,SAAI,SAAJA,EAAMG,IAAI,CACnDvC,OAAOwC,QAAQC,aAAa,GAAIC,SAASC,MAAOC,EAAa5C,OAAO6B,SAASC,KAAM,CAAEe,YAAaT,IAAI,MAAJA,SAAI,SAAJA,EAAMG,K,SAK/FO,EAAgB,CAAC5E,EAAyBE,KACrD,MAAQF,CAACA,GAAS6E,KAAWC,GAAcpD,EAAMjC,MAAMS,GACvD4B,OAAOwC,QAAQC,aAAa,GAAIC,SAASC,MAAOpC,EAAgBP,OAAO6B,SAASC,KAAM,kBAAmB,SAAU,aAAc,sBAAuB,gBACxJ,OAAOlC,EAAM9B,IAAIM,EAAM4E,EAAU,ECnBnCpF,EAAS,YAAYqF,GAAOd,EAAYc,EAAKtF,EAAMO,UAEnDL,EAAG,OAAOqF,IACR,GAAIA,IAAS,WAAY,CACvB,MAAMzF,EAAWyE,EAAYvE,EAAMO,OAAQP,EAAMS,MACjD,GAAIX,IAAQ,MAARA,SAAQ,SAARA,EAAU8E,GAAI,CAChB5E,EAAMF,SAAWA,C,MCRvBI,EAAG,OAAO,CAACsF,EAAGC,EAAOvE,IAAawE,OAAOC,KAAKF,GAAS,IAAI/B,SAAQnC,GAAOqE,EAA6BH,EAAMlE,GAAkBL,IAAQ,MAARA,SAAQ,SAARA,EAAWK,QAKnI,MAAMqE,EAA+B,CAAC9F,EAAoB+F,K,QAE/D,MAAMC,IAAe5D,EAACpC,IAAqB,MAArBA,SAAQ,SAARA,EAAuBiG,cAAU,MAAA7D,SAAA,SAAAA,EAAEuC,OAAQ,GACjE,MAAMuB,IAAeC,EAACJ,IAAwB,MAAxBA,SAAW,SAAXA,EAA0BE,cAAU,MAAAE,SAAA,SAAAA,EAAExB,OAAQ,GAGpEqB,EAAapC,SAAQwC,IACnB,MAAMC,EAAUH,EAAaI,MAAKC,GAAQA,EAAKzB,KAAOsB,EAAQtB,KAE9D,IAAKuB,IAAWA,IAAO,MAAPA,SAAO,SAAPA,EAASG,WAAWJ,IAAO,MAAPA,SAAO,SAAPA,EAASI,UAAU,CACrD,MAAMC,EAAQ,IAAIC,YAAsB,gBAAiB,CACvDC,OAAQ,IACHP,EACHI,SAAUJ,EAAQI,WAAYH,IAAO,MAAPA,SAAO,SAAPA,EAASG,WAAY,IAErDI,QAAS,OAEX3B,SAAS4B,cAAcJ,E,KAK3BP,EAAatC,SAAQyC,IACnB,MAAMD,EAAUJ,EAAaM,MAAKC,GAAQA,EAAKzB,KAAOuB,EAAQvB,KAE9D,IAAKsB,IAAWC,IAAO,MAAPA,SAAO,SAAPA,EAASG,WAAWJ,IAAO,MAAPA,SAAO,SAAPA,EAASI,UAAU,CACrD,MAAMC,EAAQ,IAAIC,YAAsB,oBAAqB,CAC3DC,OAAQ,IACHN,EACHG,SAAUH,EAAQG,WAAYJ,IAAO,MAAPA,SAAO,SAAPA,EAASI,WAAY,IAErDI,QAAS,OAEX3B,SAAS4B,cAAcJ,E,KAK3B,GAAIpF,KAAKC,UAAU0E,KAAkB3E,KAAKC,UAAU4E,GAAe,CAEjE,MAAMO,EAAQ,IAAIC,YAAkC,gBAAiB,CACnEC,OAAQ,CAAC3G,EAAU+F,GACnBa,QAAS,OAEX3B,SAAS4B,cAAcJ,E,GC9C3BrG,EAAG,OAAO,CAACqB,EAAKzB,EAAoB+F,K,cAClC,GAAItE,IAAQ,WAAY,OACxB,GAAIsE,IAAW,MAAXA,SAAW,SAAXA,EAAajB,GAAI,OACrB,KAAK9E,IAAQ,MAARA,SAAQ,SAARA,EAAU8E,IAAI,OACnB,IAAK5E,EAAMe,eAAgB,OAE3B,MAAMwF,EAAQ,IAAIC,YAAqC,sBAAuB,CAC5EC,OAAQ,CACNG,eAAgB9G,EAAS8E,GACzBa,MAAOoB,EAAmB/G,IAAQ,MAARA,SAAQ,SAARA,EAAUgH,cAAchH,IAAQ,MAARA,SAAQ,SAARA,EAAUiH,WAAY,OACxEA,UAAWjH,EAASiH,UAAY,IAAIC,mBAChCf,GAAA/D,EAAApC,IAAQ,MAARA,SAAQ,SAARA,EAAUmH,YAAQ,MAAA/E,SAAA,SAAAA,EAAEgF,aAAS,MAAAjB,SAAA,SAAAA,EAAEkB,MAAO,CAAEC,QAAQC,GAAAC,EAAAxH,IAAQ,MAARA,SAAQ,SAARA,EAAUmH,YAAQ,MAAAK,SAAA,SAAAA,EAAEJ,aAAS,MAAAG,SAAA,SAAAA,EAAEF,MAAS,OACxFrH,IAAQ,MAARA,SAAQ,SAARA,EAAUyH,YAAa,CAAEC,IAAKX,EAAmB/G,IAAQ,MAARA,SAAQ,SAARA,EAAUyH,YAAYzH,IAAQ,MAARA,SAAQ,SAARA,EAAUiH,WAAY,QAAW,GAC5GU,SAAQC,EAAA5H,IAAQ,MAARA,SAAQ,SAARA,EAAUiG,cAAU,MAAA2B,SAAA,SAAAA,EAAEjD,OAAQ,IAAIkD,KAAItB,I,UAAQ,OACpDuB,YAAW3B,GAAC/D,EAAAmE,IAAI,MAAJA,SAAI,SAAJA,EAAMwB,SAAK,MAAA3F,SAAA,SAAAA,EAAEvB,WAAmB,MAAAsF,SAAA,SAAAA,EAAE6B,OAAQ,GACtDb,UAAUZ,IAAI,MAAJA,SAAI,SAAJA,EAAM0B,iBAAkBlB,GAAmBR,IAAI,MAAJA,SAAI,SAAJA,EAAM0B,kBAAmB,GAAGjI,IAAQ,MAARA,SAAQ,SAARA,EAAUiH,WAAY,OAAS,EAChHc,MAAOhB,IAAmBS,EAAAjB,IAAI,MAAJA,SAAI,SAAJA,EAAMwB,SAAK,MAAAP,SAAA,SAAAA,EAAEU,SAAU,GAAGlI,IAAQ,MAARA,SAAQ,SAARA,EAAUiH,WAAY,OAC1ET,UAAUD,IAAI,MAAJA,SAAI,SAAJA,EAAMC,WAAY,EAC7B,KAEHI,QAAS,OAGX3B,SAAS4B,cAAcJ,EAAM,IAM/BrG,EAAG,OAAO,CAACqB,EAAKzB,EAAoB+F,K,MAClC,GAAItE,IAAQ,WAAY,OACxB,KAAKzB,IAAQ,MAARA,SAAQ,SAARA,EAAUmI,UAAUpC,IAAW,MAAXA,SAAW,SAAXA,EAAaoC,WAAWnI,IAAQ,MAARA,SAAQ,SAARA,EAAUmI,QAAQ,OACnE,IAAK,CAAC,OAAQ,cAAcC,SAASpI,EAASmI,QAAS,OAGvD,MAAME,EAAa,IAAI3B,YAAY,cAAe,CAAEC,OAAQ3G,EAAU4G,QAAS,OAC/E3B,SAAS4B,cAAcwB,GAGvB,MAAM5B,EAAQ,IAAIC,YAAY,sBAAuB,CAAEC,OAAQ3G,EAAU4G,QAAS,OAClF3B,SAAS4B,cAAcJ,GAGvB,MAAM6B,KAA8BlG,EAAApC,IAAQ,MAARA,SAAQ,SAARA,EAAUiG,cAAU,MAAA7D,SAAA,SAAAA,EAAEuC,OAAQ,IAAI4D,QAAOhC,IAAI,IAAAnE,EAAI,QAAAA,EAAAmE,IAAI,MAAJA,SAAI,SAAJA,EAAMwB,SAAK,MAAA3F,SAAA,SAAAA,EAAEoG,qBAAsB,CAAC,IACzH,GAAIF,EAAe9E,OAAS,EAAG,CAC7B,MAAMiD,EAAQ,IAAIC,YAAY,iBAAkB,CAAEC,OAAQ2B,EAAgB1B,QAAS,OACnF3B,SAAS4B,cAAcJ,E,KChD3BlE,OAAOC,iBAAiB,iBAAiB,SAAUiG,G,sBACjD,KAAKlG,SAAM,MAANA,cAAM,SAANA,OAAQmG,cAAcnG,SAAM,MAANA,cAAM,SAANA,OAAQoG,MAAM,OAGzC,MAAMpC,EAAiBkC,EAAE9B,OAGzB,MAAKvE,EAAAmE,IAAI,MAAJA,SAAI,SAAJA,EAAMwB,SAAK,MAAA3F,SAAA,SAAAA,EAAEvB,SAAS,OAG3B,MAAM8G,EAAQ,CACZ,CACEiB,SAASpB,GAACrB,EAAAI,EAAKwB,SAAK,MAAA5B,SAAA,SAAAA,EAAEtF,WAAmB,MAAA2G,SAAA,SAAAA,EAAE1C,GAC3CgD,WAAWF,GAACL,EAAAhB,EAAKwB,SAAK,MAAAR,SAAA,SAAAA,EAAE1G,WAAmB,MAAA+G,SAAA,SAAAA,EAAEI,KAC7Ca,cAAetC,EAAKuC,iBAAmB,IAAIC,KAAK,OAChDhB,MAAOhB,IAAmBiC,EAAAzC,IAAI,MAAJA,SAAI,SAAJA,EAAMwB,SAAK,MAAAiB,SAAA,SAAAA,EAAEd,SAAU,IAAGe,EAAA1C,EAAKwB,SAAK,MAAAkB,SAAA,SAAAA,EAAEhC,WAAY,OAC5EA,UAAUiC,EAAA3C,EAAKwB,SAAK,MAAAmB,SAAA,SAAAA,EAAEjC,SACtBT,SAAUD,EAAKC,SACfW,UAAUZ,IAAI,MAAJA,SAAI,SAAJA,EAAM0B,iBAAkBlB,GAAmBR,IAAI,MAAJA,SAAI,SAAJA,EAAM0B,kBAAmB,IAAGkB,EAAA5C,EAAKwB,SAAK,MAAAoB,SAAA,SAAAA,EAAElC,WAAY,OAAS,IAKtH,GAAI1E,SAAM,MAANA,cAAM,SAANA,OAAQoG,KAAM,CAChBpG,OAAOoG,KAAK,QAAS,cAAe,CAClChB,S,CAKJ,GAAIpF,SAAM,MAANA,cAAM,SAANA,OAAQmG,UAAW,CACrBnG,OAAOmG,UAAUU,KAAK,CAAEC,UAAW,OACnC9G,OAAOmG,UAAUU,KAAK,CACpB3C,MAAO,cACP4C,UAAW,CACT1E,KAAM,CACJgD,W,CAKV,IAKApF,OAAOC,iBAAiB,uBAAuB,SAAUiG,G,cACvD,KAAKlG,SAAM,MAANA,cAAM,SAANA,OAAQmG,cAAcnG,SAAM,MAANA,cAAM,SAANA,OAAQoG,MAAM,OAEzC,MAAM3I,EAAWyI,EAAE9B,OAEnB,MAAMhC,EAAO,CACXmC,eAAgB9G,IAAQ,MAARA,SAAQ,SAARA,EAAU8E,GAC1Ba,MAAOoB,EAAmB/G,IAAQ,MAARA,SAAQ,SAARA,EAAUgH,cAAchH,IAAQ,MAARA,SAAQ,SAARA,EAAUiH,WAAY,OACxEA,UAAWjH,EAASiH,UAAY,IAAIC,mBAChCf,GAAA/D,EAAApC,IAAQ,MAARA,SAAQ,SAARA,EAAUmH,YAAQ,MAAA/E,SAAA,SAAAA,EAAEgF,aAAS,MAAAjB,SAAA,SAAAA,EAAEkB,MAAO,CAAEC,QAAQC,GAAAC,EAAAxH,IAAQ,MAARA,SAAQ,SAARA,EAAUmH,YAAQ,MAAAK,SAAA,SAAAA,EAAEJ,aAAS,MAAAG,SAAA,SAAAA,EAAEF,MAAS,OACxFrH,IAAQ,MAARA,SAAQ,SAARA,EAAUyH,YAAa,CAAEC,IAAKX,EAAmB/G,IAAQ,MAARA,SAAQ,SAARA,EAAUyH,YAAYzH,IAAQ,MAARA,SAAQ,SAARA,EAAUiH,WAAY,QAAW,GAC5GU,SAAQC,EAAA5H,IAAQ,MAARA,SAAQ,SAARA,EAAUiG,cAAU,MAAA2B,SAAA,SAAAA,EAAEjD,OAAQ,IAAIkD,KAAItB,I,kBAAQ,OACpDqC,SAASzC,GAAC/D,EAAAmE,IAAI,MAAJA,SAAI,SAAJA,EAAMwB,SAAK,MAAA3F,SAAA,SAAAA,EAAEvB,WAAmB,MAAAsF,SAAA,SAAAA,EAAErB,GAC5CmC,UAAWjH,EAASiH,UAAY,IAAIC,cACpCY,YAAWP,GAACC,EAAAjB,IAAI,MAAJA,SAAI,SAAJA,EAAMwB,SAAK,MAAAP,SAAA,SAAAA,EAAE3G,WAAmB,MAAA0G,SAAA,SAAAA,EAAES,OAAQ,GACtDb,UAAUZ,IAAI,MAAJA,SAAI,SAAJA,EAAM0B,iBAAkBlB,GAAmBR,IAAI,MAAJA,SAAI,SAAJA,EAAM0B,kBAAmB,IAAGL,EAAArB,IAAI,MAAJA,SAAI,SAAJA,EAAMwB,SAAK,MAAAH,SAAA,SAAAA,EAAEX,WAAY,OAAS,EACnHc,MAAOhB,IAAmBiC,EAAAzC,IAAI,MAAJA,SAAI,SAAJA,EAAMwB,SAAK,MAAAiB,SAAA,SAAAA,EAAEd,SAAU,IAAGe,EAAA1C,IAAI,MAAJA,SAAI,SAAJA,EAAMwB,SAAK,MAAAkB,SAAA,SAAAA,EAAEhC,WAAY,OAC7ET,UAAUD,IAAI,MAAJA,SAAI,SAAJA,EAAMC,WAAY,EAC5BqC,cAAetC,EAAKuC,iBAAmB,IAAIC,KAAK,OACjD,KAIH,GAAIxG,SAAM,MAANA,cAAM,SAANA,OAAQoG,KAAM,CAChBpG,OAAOoG,KAAK,QAAS,WAAYhE,E,CAInC,GAAIpC,SAAM,MAANA,cAAM,SAANA,OAAQmG,UAAW,CACrBnG,OAAOmG,UAAUU,KAAK,CAAEC,UAAW,OACnC9G,OAAOmG,UAAUU,KAAK,CACpB3C,MAAO,WACP4C,UAAW1E,G,CAGjB,W"}