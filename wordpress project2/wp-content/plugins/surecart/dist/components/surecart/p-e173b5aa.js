import{m as o}from"./p-7ef0f71c.js";import{g as i,b as d,a as n}from"./p-1c2e2695.js";import{c as l}from"./p-25433d0f.js";import{g as v}from"./p-4d73f82a.js";import{g as t}from"./p-a3ae8411.js";const{checkout:u}=t(),{state:e,onChange:c,on:r,set:s,get:a,dispose:w}=l({formId:null,groupId:null,mode:"live",locks:[],product:null,checkout:null,currencyCode:"usd",abandonedCheckoutEnabled:!0,initialLineItems:[],isCheckoutPage:!1,validateStock:!1,...u},((o,i)=>JSON.stringify(o)!==JSON.stringify(i))),m=(o,i)=>{try{return JSON.parse(o.getItem(i))}catch{return null}},f=o=>{let i=!1;return()=>{i||(i=!0,setTimeout((()=>{o(),i=!1}),0))}},p=(o,i,n,t=!1)=>{var d;const e=l(null!==(d=m(o,i))&&void 0!==d?d:n,((o,i)=>JSON.stringify(o)!==JSON.stringify(i))),u=f((()=>o.setItem(i,JSON.stringify(e.state))));return u(),t&&window.addEventListener("storage",(()=>{const n=m(o,i);if(null!==n)for(const o in n)e.set(o,n[o])})),e.use({set:u,reset:u}),e},b=(o,i,n=!1)=>p(localStorage,o,i,n);function C(o){const n=o.indexOf("?");if(-1===n)return o;const t=i(o),e=o.substr(0,n);for(var l=arguments.length,u=new Array(l>1?l-1:0),a=1;a<l;a++)u[a-1]=arguments[a];u.forEach((o=>delete t[o]));const r=d(t);return r?e+"?"+r:e}var S;const _=!!(null===(S=null===window||void 0===window?void 0:window.scData)||void 0===S?void 0:S.do_not_persist_cart)||!!v(window.location.href,"no_cart"),h=_?l({live:{},test:{}}):b("surecart-local-storage",{live:{},test:{}},!0),{state:k,onChange:g,on:y,set:U,get:D,dispose:O}=h;window.scStore=h;const E=(o,i)=>{var n;return(null===(n=h.state[i])||void 0===n?void 0:n[o])||{}},J=(o,i)=>{var t;const d=(null==o?void 0:o.live_mode)?"live":"test";h.set(d,{...h.state[d],[i]:o}),e.formId===i&&e.mode===d&&(e.checkout=o),(null===(t=null===window||void 0===window?void 0:window.scData)||void 0===t?void 0:t.do_not_persist_cart)&&(null==o?void 0:o.id)&&window.history.replaceState({},document.title,n(window.location.href,{checkout_id:null==o?void 0:o.id}))},N=(o,i)=>{const{[o]:n,...t}=h.state[i];return window.history.replaceState({},document.title,C(window.location.href,"redirect_status","coupon","line_items","confirm_checkout_id","checkout_id")),h.set(i,t)};c("checkout",(o=>J(o,e.formId))),r("get",(o=>{if("checkout"===o){const o=E(e.formId,e.mode);(null==o?void 0:o.id)&&(e.checkout=o)}})),y("set",((o,i,n)=>Object.keys(i||{}).forEach((o=>j(i[o],null==n?void 0:n[o])))));const j=(o,i)=>{var n,t;const d=(null===(n=null==o?void 0:o.line_items)||void 0===n?void 0:n.data)||[],e=(null===(t=null==i?void 0:i.line_items)||void 0===t?void 0:t.data)||[];if(d.forEach((o=>{const i=e.find((i=>i.id===o.id));if(!i||(null==i?void 0:i.quantity)<(null==o?void 0:o.quantity)){const n=new CustomEvent("scAddedToCart",{detail:{...o,quantity:o.quantity-((null==i?void 0:i.quantity)||0)},bubbles:!0});document.dispatchEvent(n)}})),e.forEach((o=>{const i=d.find((i=>i.id===o.id));if(!i||(null==o?void 0:o.quantity)>(null==i?void 0:i.quantity)){const n=new CustomEvent("scRemovedFromCart",{detail:{...o,quantity:o.quantity-((null==i?void 0:i.quantity)||0)},bubbles:!0});document.dispatchEvent(n)}})),JSON.stringify(d)!==JSON.stringify(e)){const n=new CustomEvent("scCartUpdated",{detail:[o,i],bubbles:!0});document.dispatchEvent(n)}};r("set",((i,n,t)=>{var d,l,u,a,r;if("checkout"!==i)return;if(null==t?void 0:t.id)return;if(!(null==n?void 0:n.id))return;if(!e.isCheckoutPage)return;const c=new CustomEvent("scCheckoutInitiated",{detail:{transaction_id:n.id,value:o(null==n?void 0:n.total_amount,(null==n?void 0:n.currency)||"USD"),currency:(n.currency||"").toUpperCase(),...(null===(l=null===(d=null==n?void 0:n.discount)||void 0===d?void 0:d.promotion)||void 0===l?void 0:l.code)?{coupon:null===(a=null===(u=null==n?void 0:n.discount)||void 0===u?void 0:u.promotion)||void 0===a?void 0:a.code}:{},...(null==n?void 0:n.tax_amount)?{tax:o(null==n?void 0:n.tax_amount,(null==n?void 0:n.currency)||"USD")}:{},items:((null===(r=null==n?void 0:n.line_items)||void 0===r?void 0:r.data)||[]).map((i=>{var t,d,e;return{item_name:(null===(d=null===(t=null==i?void 0:i.price)||void 0===t?void 0:t.product)||void 0===d?void 0:d.name)||"",discount:(null==i?void 0:i.discount_amount)?o((null==i?void 0:i.discount_amount)||0,(null==n?void 0:n.currency)||"USD"):0,price:o((null===(e=null==i?void 0:i.price)||void 0===e?void 0:e.amount)||0,(null==n?void 0:n.currency)||"USD"),quantity:(null==i?void 0:i.quantity)||1}}))},bubbles:!0});document.dispatchEvent(c)})),r("set",((o,i,n)=>{var t;if("checkout"!==o)return;if(!(null==i?void 0:i.status)||(null==n?void 0:n.status)===(null==i?void 0:i.status))return;if(!["paid","processing"].includes(i.status))return;const d=new CustomEvent("scOrderPaid",{detail:i,bubbles:!0});document.dispatchEvent(d);const e=new CustomEvent("scCheckoutCompleted",{detail:i,bubbles:!0});document.dispatchEvent(e);const l=((null===(t=null==i?void 0:i.line_items)||void 0===t?void 0:t.data)||[]).filter((o=>{var i;return(null===(i=null==o?void 0:o.price)||void 0===i?void 0:i.trial_duration_days)>0}));if(l.length>0){const o=new CustomEvent("scTrialStarted",{detail:l,bubbles:!0});document.dispatchEvent(o)}})),window.addEventListener("scAddedToCart",(function(i){var n,t,d,e,l,u,a,r,c;if(!(null===window||void 0===window?void 0:window.dataLayer)&&!(null===window||void 0===window?void 0:window.gtag))return;const v=i.detail;if(!(null===(n=null==v?void 0:v.price)||void 0===n?void 0:n.product))return;const s=[{item_id:null===(d=null===(t=v.price)||void 0===t?void 0:t.product)||void 0===d?void 0:d.id,item_name:null===(l=null===(e=v.price)||void 0===e?void 0:e.product)||void 0===l?void 0:l.name,item_variant:(v.variant_options||[]).join(" / "),price:o((null===(u=null==v?void 0:v.price)||void 0===u?void 0:u.amount)||0,(null===(a=v.price)||void 0===a?void 0:a.currency)||"USD"),currency:null===(r=v.price)||void 0===r?void 0:r.currency,quantity:v.quantity,discount:(null==v?void 0:v.discount_amount)?o((null==v?void 0:v.discount_amount)||0,(null===(c=v.price)||void 0===c?void 0:c.currency)||"USD"):0}];(null===window||void 0===window?void 0:window.gtag)&&window.gtag("event","add_to_cart",{items:s}),(null===window||void 0===window?void 0:window.dataLayer)&&(window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"add_to_cart",ecommerce:{data:{items:s}}}))})),window.addEventListener("scCheckoutCompleted",(function(i){var n,t,d,e,l;if(!(null===window||void 0===window?void 0:window.dataLayer)&&!(null===window||void 0===window?void 0:window.gtag))return;const u=i.detail,a={transaction_id:null==u?void 0:u.id,value:o(null==u?void 0:u.total_amount,(null==u?void 0:u.currency)||"USD"),currency:(u.currency||"").toUpperCase(),...(null===(t=null===(n=null==u?void 0:u.discount)||void 0===n?void 0:n.promotion)||void 0===t?void 0:t.code)?{coupon:null===(e=null===(d=null==u?void 0:u.discount)||void 0===d?void 0:d.promotion)||void 0===e?void 0:e.code}:{},...(null==u?void 0:u.tax_amount)?{tax:o(null==u?void 0:u.tax_amount,(null==u?void 0:u.currency)||"USD")}:{},items:((null===(l=null==u?void 0:u.line_items)||void 0===l?void 0:l.data)||[]).map((i=>{var n,t,d,e,l,a,r;return{item_id:null===(t=null===(n=null==i?void 0:i.price)||void 0===n?void 0:n.product)||void 0===t?void 0:t.id,currency:(u.currency||"").toUpperCase(),item_name:(null===(e=null===(d=null==i?void 0:i.price)||void 0===d?void 0:d.product)||void 0===e?void 0:e.name)||"",discount:(null==i?void 0:i.discount_amount)?o((null==i?void 0:i.discount_amount)||0,(null===(l=null==i?void 0:i.price)||void 0===l?void 0:l.currency)||"USD"):0,price:o((null===(a=null==i?void 0:i.price)||void 0===a?void 0:a.amount)||0,(null===(r=null==i?void 0:i.price)||void 0===r?void 0:r.currency)||"USD"),quantity:(null==i?void 0:i.quantity)||1,item_variant:(i.variant_options||[]).join(" / ")}}))};(null===window||void 0===window?void 0:window.gtag)&&window.gtag("event","purchase",a),(null===window||void 0===window?void 0:window.dataLayer)&&(window.dataLayer.push({ecommerce:null}),window.dataLayer.push({event:"purchase",ecommerce:a}))}));export{J as a,c as b,N as c,r as d,E as g,g as o,C as r,e as s};