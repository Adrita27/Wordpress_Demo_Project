{"version":3,"names":["scProductBuyButtonCss","ScProductBuyButton","handleCartClick","e","preventDefault","state","busy","_a","selectedPrice","ad_hoc","dialog","this","addToCart","checkoutUrl","_c","_b","window","scData","pages","checkout","location","assign","getProductBuyLink","no_cart","submitCartForm","componentDidLoad","link","el","querySelector","updateProductLink","onChange","href","render","h","Host","class","disabled","isProductOutOfStock","isSelectedVariantMissing","onClick"],"sources":["./src/components/controllers/product/sc-product-buy-button/sc-product-buy-button.scss?tag=sc-product-buy-button","./src/components/controllers/product/sc-product-buy-button/sc-product-buy-button.tsx"],"sourcesContent":["sc-product-buy-button {\n  position: relative;\n\n  a.wp-block-button__link {\n    position: relative;\n    text-decoration: none;\n  }\n\n  .sc-block-button--sold-out,\n  .sc-block-button--unavailable {\n    display: none !important;\n  }\n\n  &.is-unavailable {\n    a {\n      display: none !important;\n    }\n    .sc-block-button--unavailable {\n      display: initial !important;\n    }\n  }\n\n  &.is-sold-out {\n    a {\n      display: none !important;\n    }\n    .sc-block-button--sold-out {\n      display: initial !important;\n    }\n  }\n\n  sc-spinner::part(base) {\n    --indicator-color: currentColor;\n    --spinner-size: 12px;\n    position: absolute;\n    top: calc(50% - var(--spinner-size) + (var(--spinner-size) / 4));\n    left: calc(50% - var(--spinner-size) + (var(--spinner-size) / 4));\n  }\n\n  [data-text],\n  [data-loader] {\n    transition: opacity var(--sc-transition-fast) ease-in-out, visibility var(--sc-transition-fast) ease-in-out;\n  }\n\n  [data-loader] {\n    opacity: 0;\n    visibility: hidden;\n  }\n\n  &.is-disabled {\n    pointer-events: none;\n  }\n\n  &.is-busy {\n    [data-text] {\n      opacity: 0;\n      visibility: hidden;\n    }\n    [data-loader] {\n      opacity: 1;\n      visibility: visible;\n    }\n  }\n\n  &.is-out-of-stock {\n    [data-text] {\n      opacity: 0.6;\n    }\n  }\n}\n","import { Component, Element, h, Host, Prop } from '@stencil/core';\nimport { state } from '@store/product';\nimport { __ } from '@wordpress/i18n';\nimport { onChange } from '@store/product';\nimport { isProductOutOfStock, isSelectedVariantMissing } from '@store/product/getters';\nimport { getProductBuyLink, submitCartForm } from '@store/product/mutations';\n\n@Component({\n  tag: 'sc-product-buy-button',\n  styleUrl: 'sc-product-buy-button.scss',\n  shadow: false,\n})\nexport class ScProductBuyButton {\n  @Element() el: HTMLScProductBuyButtonElement;\n\n  // Is add to cart enabled\n  @Prop() addToCart: boolean;\n\n  handleCartClick(e) {\n    e.preventDefault();\n\n    // already busy, do nothing.\n    if (state.busy) return;\n\n    // ad hoc price, use the dialog.\n    if (state?.selectedPrice?.ad_hoc) {\n      return (state.dialog = this.addToCart ? 'ad_hoc_cart' : 'ad_hoc_buy');\n    }\n\n    // if add to cart is undefined/false navigate to buy url\n    if (!this.addToCart) {\n      const checkoutUrl = window?.scData?.pages?.checkout;\n      if (!checkoutUrl) return;\n      return window.location.assign(getProductBuyLink(checkoutUrl, { no_cart: !this.addToCart }));\n    }\n\n    // submit the cart form.\n    submitCartForm();\n  }\n\n  private link: HTMLAnchorElement;\n  componentDidLoad() {\n    this.link = this.el.querySelector('a');\n    this.updateProductLink();\n    onChange('selectedPrice', () => this.updateProductLink());\n    onChange('selectedVariant', () => this.updateProductLink());\n  }\n\n  updateProductLink() {\n    const checkoutUrl = window?.scData?.pages?.checkout;\n    if (!checkoutUrl || !this.link) return;\n    this.link.href = getProductBuyLink(checkoutUrl, !this.addToCart ? { no_cart: true } : {});\n  }\n\n  render() {\n    return (\n      <Host\n        class={{\n          'is-busy': state.busy && !!this.addToCart,\n          'is-disabled': state.disabled,\n          'is-sold-out': isProductOutOfStock() && !isSelectedVariantMissing(),\n          'is-unavailable': isSelectedVariantMissing(),\n        }}\n        onClick={e => this.handleCartClick(e)}\n      >\n        <slot />\n      </Host>\n    );\n  }\n}\n"],"mappings":"qaAAA,MAAMA,EAAwB,ixC,MCYjBC,EAAkB,M,kDAM7BC,gBAAgBC,G,UACdA,EAAEC,iBAGF,GAAIC,EAAMC,KAAM,OAGhB,IAAIC,EAAAF,IAAK,MAALA,SAAK,SAALA,EAAOG,iBAAa,MAAAD,SAAA,SAAAA,EAAEE,OAAQ,CAChC,OAAQJ,EAAMK,OAASC,KAAKC,UAAY,cAAgB,Y,CAI1D,IAAKD,KAAKC,UAAW,CACnB,MAAMC,GAAcC,GAAAC,EAAAC,SAAM,MAANA,cAAM,SAANA,OAAQC,UAAM,MAAAF,SAAA,SAAAA,EAAEG,SAAK,MAAAJ,SAAA,SAAAA,EAAEK,SAC3C,IAAKN,EAAa,OAClB,OAAOG,OAAOI,SAASC,OAAOC,EAAkBT,EAAa,CAAEU,SAAUZ,KAAKC,Y,CAIhFY,G,CAIFC,mBACEd,KAAKe,KAAOf,KAAKgB,GAAGC,cAAc,KAClCjB,KAAKkB,oBACLC,EAAS,iBAAiB,IAAMnB,KAAKkB,sBACrCC,EAAS,mBAAmB,IAAMnB,KAAKkB,qB,CAGzCA,oB,QACE,MAAMhB,GAAcE,GAAAR,EAAAS,SAAM,MAANA,cAAM,SAANA,OAAQC,UAAM,MAAAV,SAAA,SAAAA,EAAEW,SAAK,MAAAH,SAAA,SAAAA,EAAEI,SAC3C,IAAKN,IAAgBF,KAAKe,KAAM,OAChCf,KAAKe,KAAKK,KAAOT,EAAkBT,GAAcF,KAAKC,UAAY,CAAEW,QAAS,MAAS,G,CAGxFS,SACE,OACEC,EAACC,EAAI,CACHC,MAAO,CACL,UAAW9B,EAAMC,QAAUK,KAAKC,UAChC,cAAeP,EAAM+B,SACrB,cAAeC,MAA0BC,IACzC,iBAAkBA,KAEpBC,QAASpC,GAAKQ,KAAKT,gBAAgBC,IAEnC8B,EAAA,a"}