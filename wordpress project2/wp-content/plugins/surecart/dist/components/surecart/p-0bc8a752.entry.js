import{r as i,h as t,F as o,a as e}from"./p-cc7ce8c7.js";import{g as n}from"./p-df0f6f3f.js";import{s,b as l}from"./p-e173b5aa.js";import{g as r}from"./p-d5a52441.js";import{u as d,a}from"./p-86121117.js";import{u as v}from"./p-7c0fbe03.js";import{c}from"./p-05fc1ee0.js";import{i as u,a as p}from"./p-a3ae8411.js";import"./p-7ef0f71c.js";import"./p-1c2e2695.js";import"./p-25433d0f.js";import"./p-4d73f82a.js";import"./p-18e45a13.js";import"./p-61e10f79.js";import"./p-09484d0e.js";const h=".sc-checkout-product-price-variant-selector{position:relative}.sc-checkout-product-price-variant-selector>*:not(:last-child){display:block;margin-bottom:var(--sc-form-row-spacing, 0.75em)}.sc-checkout-product-price-variant-selector__pills-wrapper{display:flex;flex-wrap:wrap;gap:var(--sc-spacing-x-small)}.sc-checkout-product-price-variant-selector__hidden-input{position:absolute !important;top:0 !important;left:0 !important;opacity:0 !important;padding:0px !important;margin:0px !important;pointer-events:none !important;width:0 !important}";const f=class{constructor(t){i(this,t);this.product=undefined;this.label=undefined;this.selectedVariant=undefined;this.selectedPrice=undefined;this.option1=undefined;this.option2=undefined;this.option3=undefined}handleOptionChange(){var i,t;this.selectedVariant=r({variants:(t=(i=this.product)===null||i===void 0?void 0:i.variants)===null||t===void 0?void 0:t.data,values:{...this.option1?{option_1:this.option1}:{},...this.option2?{option_2:this.option2}:{},...this.option3?{option_3:this.option3}:{}}})}isSelectedVariantOutOfStock(){var i,t;return((i=this.product)===null||i===void 0?void 0:i.stock_enabled)&&this.hasVariants()&&!((t=this.product)===null||t===void 0?void 0:t.allow_out_of_stock_purchases)&&this.selectedVariant.available_stock<1}hasRequiredSelectedVariant(){var i;if(!this.hasVariants()){return true}return(i=this.selectedVariant)===null||i===void 0?void 0:i.id}async reportValidity(){this.input.setCustomValidity("");if(!this.hasVariants()){return this.input.reportValidity()}if(!this.hasRequiredSelectedVariant()){this.input.setCustomValidity(wp.i18n.__("Please choose an available option.","surecart"));return this.input.reportValidity()}if(this.isSelectedVariantOutOfStock()){this.input.setCustomValidity(wp.i18n.__("This selection is not available.","surecart"));return this.input.reportValidity()}return this.input.reportValidity()}getSelectedPrice(){var i,t,o,e,n;if(((o=(t=(i=this.product)===null||i===void 0?void 0:i.prices)===null||t===void 0?void 0:t.data)===null||o===void 0?void 0:o.length)===1){return(n=(e=this.product)===null||e===void 0?void 0:e.prices)===null||n===void 0?void 0:n.data[0]}return this.selectedPrice}async updateLineItems(){var i,t,o,e,n;const l=this.getSelectedPrice();if(!(l===null||l===void 0?void 0:l.id))return;const r=this.lineItem();if(((i=r===null||r===void 0?void 0:r.price)===null||i===void 0?void 0:i.id)===(l===null||l===void 0?void 0:l.id)&&((t=r===null||r===void 0?void 0:r.variant)===null||t===void 0?void 0:t.id)===((o=this.selectedVariant)===null||o===void 0?void 0:o.id))return;if(!this.hasRequiredSelectedVariant())return;if(this.isSelectedVariantOutOfStock())return;try{v("FETCH");if(r===null||r===void 0?void 0:r.id){s.checkout=await d({id:r===null||r===void 0?void 0:r.id,data:{variant:(e=this.selectedVariant)===null||e===void 0?void 0:e.id,price:l===null||l===void 0?void 0:l.id,quantity:1}})}else{s.checkout=await a({checkout:s.checkout,data:{variant:(n=this.selectedVariant)===null||n===void 0?void 0:n.id,price:l===null||l===void 0?void 0:l.id,quantity:1}})}v("RESOLVE")}catch(i){console.error(i);c(i);v("REJECT")}}componentWillLoad(){this.removeListener=l("checkout",(()=>{var i,t,o;const e=this.lineItem();this.selectedVariant=e===null||e===void 0?void 0:e.variant;this.selectedPrice=e===null||e===void 0?void 0:e.price;this.option1=(i=e===null||e===void 0?void 0:e.variant)===null||i===void 0?void 0:i.option_1;this.option2=(t=e===null||e===void 0?void 0:e.variant)===null||t===void 0?void 0:t.option_2;this.option3=(o=e===null||e===void 0?void 0:e.variant)===null||o===void 0?void 0:o.option_3}))}disconnectedCallback(){this.removeListener()}lineItem(){var i;return n((i=this.product)===null||i===void 0?void 0:i.id)}hasVariants(){var i,t,o;return((o=(t=(i=this.product)===null||i===void 0?void 0:i.variants)===null||t===void 0?void 0:t.data)===null||o===void 0?void 0:o.length)>0}render(){var i,e,n,s,l;return t("div",{class:"sc-checkout-product-price-variant-selector"},(this.product.variant_options.data||[]).map((({name:i,values:e},n)=>t("sc-form-control",{label:i},t("div",{class:"sc-checkout-product-price-variant-selector__pills-wrapper"},(e||[]).map((e=>{const s=[n+1,e,{...this.option1?{option_1:this.option1}:{},...this.option2?{option_2:this.option2}:{},...this.option3?{option_3:this.option3}:{}},this.product];const l=u.apply(void 0,s)||p.apply(void 0,s);return t("sc-pill-option",{isUnavailable:l,isSelected:this[`option${n+1}`]===e,onClick:()=>this[`option${n+1}`]=e},t("span",{"aria-hidden":"true"},e),t("sc-visually-hidden",null,wp.i18n.sprintf(wp.i18n.__("Select %s: %s","surecart"),i,e),l&&t(o,null," ",wp.i18n.__("(option unavailable)","surecart"))))})))))),((n=(e=(i=this.product)===null||i===void 0?void 0:i.prices)===null||e===void 0?void 0:e.data)===null||n===void 0?void 0:n.length)>1&&t("sc-form-control",{label:!!((s=this.product.variant_options.data)===null||s===void 0?void 0:s.length)?this.label:null},t("sc-choices",null,(this.product.prices.data||[]).sort(((i,t)=>(i===null||i===void 0?void 0:i.position)-(t===null||t===void 0?void 0:t.position))).map((i=>{var o,e,n;return t("sc-price-choice-container",{required:true,price:i,label:(i===null||i===void 0?void 0:i.name)||((o=this.product)===null||o===void 0?void 0:o.name),checked:((n=(e=this.lineItem())===null||e===void 0?void 0:e.price)===null||n===void 0?void 0:n.id)===(i===null||i===void 0?void 0:i.id),onScChange:t=>{if(t.target.checked){this.selectedPrice=i}}})})))),t("input",{class:"sc-checkout-product-price-variant-selector__hidden-input",ref:i=>this.input=i,value:(l=this.selectedVariant)===null||l===void 0?void 0:l.id}))}get el(){return e(this)}static get watchers(){return{option1:["handleOptionChange"],option2:["handleOptionChange"],option3:["handleOptionChange"],selectedVariant:["updateLineItems"],selectedPrice:["updateLineItems"]}}};f.style=h;export{f as sc_checkout_product_price_variant_selector};
//# sourceMappingURL=p-0bc8a752.entry.js.map