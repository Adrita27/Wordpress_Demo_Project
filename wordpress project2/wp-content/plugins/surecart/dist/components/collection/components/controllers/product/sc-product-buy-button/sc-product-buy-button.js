import{h,Host}from"@stencil/core";import{state}from"@store/product";import{onChange}from"@store/product";import{isProductOutOfStock,isSelectedVariantMissing}from"@store/product/getters";import{getProductBuyLink,submitCartForm}from"@store/product/mutations";export class ScProductBuyButton{constructor(){this.addToCart=void 0}handleCartClick(t){var o,e,i;if(t.preventDefault(),!state.busy){if(null===(o=null==state?void 0:state.selectedPrice)||void 0===o?void 0:o.ad_hoc)return state.dialog=this.addToCart?"ad_hoc_cart":"ad_hoc_buy";if(!this.addToCart){const t=null===(i=null===(e=null===window||void 0===window?void 0:window.scData)||void 0===e?void 0:e.pages)||void 0===i?void 0:i.checkout;if(!t)return;return window.location.assign(getProductBuyLink(t,{no_cart:!this.addToCart}))}submitCartForm()}}componentDidLoad(){this.link=this.el.querySelector("a"),this.updateProductLink(),onChange("selectedPrice",(()=>this.updateProductLink())),onChange("selectedVariant",(()=>this.updateProductLink()))}updateProductLink(){var t,o;const e=null===(o=null===(t=null===window||void 0===window?void 0:window.scData)||void 0===t?void 0:t.pages)||void 0===o?void 0:o.checkout;e&&this.link&&(this.link.href=getProductBuyLink(e,this.addToCart?{}:{no_cart:!0}))}render(){return h(Host,{class:{"is-busy":state.busy&&!!this.addToCart,"is-disabled":state.disabled,"is-sold-out":isProductOutOfStock()&&!isSelectedVariantMissing(),"is-unavailable":isSelectedVariantMissing()},onClick:t=>this.handleCartClick(t)},h("slot",null))}static get is(){return"sc-product-buy-button"}static get originalStyleUrls(){return{$:["sc-product-buy-button.scss"]}}static get styleUrls(){return{$:["sc-product-buy-button.css"]}}static get properties(){return{addToCart:{type:"boolean",mutable:!1,complexType:{original:"boolean",resolved:"boolean",references:{}},required:!1,optional:!1,docs:{tags:[],text:""},attribute:"add-to-cart",reflect:!1}}}static get elementRef(){return"el"}}