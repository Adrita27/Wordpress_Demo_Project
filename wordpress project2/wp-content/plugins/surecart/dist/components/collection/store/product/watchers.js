import state,{onChange}from"./store";import{getVariantFromValues}from"../../functions/util";import{isStockNeedsToBeChecked}from"./getters";import{speak}from"@wordpress/a11y";import{__,sprintf}from"@wordpress/i18n";onChange("selectedPrice",(t=>{var e;state.total=state.adHocAmount||(null==t?void 0:t.amount)||0,state.adHocAmount=null==t?void 0:t.amount,state.disabled=(null==t?void 0:t.archived)||(null===(e=state.product)||void 0===e?void 0:e.archived)})),onChange("variantValues",(t=>{const e=getVariantFromValues({variants:state.variants,values:t});e&&(state.selectedVariant=e)})),onChange("selectedVariant",(()=>{state.selectedVariant&&isStockNeedsToBeChecked&&(null==state?void 0:state.selectedVariant.available_stock)<(null==state?void 0:state.quantity)&&(state.quantity=(null==state?void 0:state.selectedVariant.available_stock)||1,speak(sprintf(__("There are just %d items left in stock, and the quantity has been adjusted to %d.","surecart"),state.quantity,state.quantity),"assertive"))})),onChange("selectedPrice",(()=>setLineItem())),onChange("selectedVariant",(()=>setLineItem())),onChange("adHocAmount",(()=>setLineItem())),onChange("quantity",(()=>setLineItem()));const setLineItem=()=>{var t,e,a,s;state.line_item={price_id:null===(t=state.selectedPrice)||void 0===t?void 0:t.id,quantity:(null===(e=state.selectedPrice)||void 0===e?void 0:e.ad_hoc)?1:state.quantity,...(null===(a=state.selectedPrice)||void 0===a?void 0:a.ad_hoc)?{ad_hoc_amount:state.adHocAmount}:{},variant:null===(s=state.selectedVariant)||void 0===s?void 0:s.id}};